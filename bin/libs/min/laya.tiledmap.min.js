!function(t,i,e){var r=(e.un,e.uns,e["static"],e["class"]),h=e.getset,a=(e.__newvec,laya.resource.Texture),s=laya.utils.Browser,n=laya.display.Sprite,l=laya.maths.Point,o=laya.maths.Rectangle,_=(laya.webgl.WebGL,laya.net.Loader),m=(laya.utils.Handler,function(){function t(){this._jsonData=null,this._tileTexSetArr=[],this._texArray=[],this._x=0,this._y=0,this._width=0,this._height=0,this._mapW=0,this._mapH=0,this._mapTileW=0,this._mapTileH=0,this._mapSprite=null,this._layerArray=[],this._gridArray=[],this._showGridKey=!1,this._totalGridNum=0,this._gridW=0,this._gridH=0,this._gridWidth=450,this._gridHeight=450,this._jsonLoader=null,this._loader=null,this._tileSetArray=[],this._currTileSet=null,this._completeHandler=null,this._index=0,this._animationDic={},this._orientation="orthogonal",this._renderOrder="right-down",this._colorArray=["FF","00","33","66"],this._rect=new o,this._paddingRect=new o,this._mapRect=new i,this._mapLastRect=new i}var i,s,l;r(t,"laya.map.TiledMap");var m=t.prototype;return m.createMap=function(t,i,e,r,h){this._rect.x=i.x,this._rect.y=i.y,this._rect.width=i.width,this._rect.height=i.height,this._completeHandler=e,r?this._paddingRect.copyFrom(r):this._paddingRect.setTo(0,0,0,0),h&&(this._gridWidth=h.x,this._gridHeight=h.y),this._jsonLoader=new _,this._jsonLoader.once("complete",this,this.onJsonComplete),this._jsonLoader.load(t,"json",!1)},m.onJsonComplete=function(t){this._mapSprite=new n,e.stage.addChild(this._mapSprite);var i=this._jsonData=t;this._orientation=i.orientation,this._renderOrder=i.renderorder,this._mapW=i.width,this._mapH=i.height,this._mapTileW=i.tilewidth,this._mapTileH=i.tileheight,this._width=this._mapTileW*this._mapW,this._height=this._mapTileH*this._mapH,this._mapLastRect.top=this._mapLastRect.bottom=this._mapLastRect.left=this._mapLastRect.right=-1,this._mapRect.top=Math.floor(this._rect.y/this._mapTileH),this._mapRect.bottom=Math.floor((this._rect.y+this._rect.height)/this._mapTileH),this._mapRect.left=Math.floor(this._rect.x/this._mapTileW),this._mapRect.right=Math.floor((this._rect.x+this._rect.width)/this._mapTileW);for(var r,h,a=i.tilesets,o=0;o<a.length;o++){r=a[o],h=new l,h.init(r),this._tileSetArray.push(h);var m=r.tiles;if(m)for(var p in m){var d=m[p].animation;if(d){var c=new s;this._animationDic[p]=c;for(var u=0;u<d.length;u++){var g=d[u];c.mAniIdArray.push(g.tileid),c.mDurationTimeArray.push(g.duration)}}}}this._tileTexSetArr.push(null),this._tileSetArray.length>0&&(h=this._currTileSet=this._tileSetArray.shift(),this._loader=new _,this._loader.once("complete",this,this.onTextureComplete),this._loader.load(h.image,"image",!1))},m.onTextureComplete=function(t){var i=(this._jsonData,t);this._texArray.push(i);for(var e=this._currTileSet,r=e.tilewidth,h=e.tileheight,s=e.imagewidth,n=e.imageheight,l=(e.firstgid,Math.floor((s-e.margin-r)/(r+e.spacing))+1),o=Math.floor((n-e.margin-h)/(h+e.spacing))+1,_=null,m=0;o>m;m++)for(var d=0;l>d;d++)_=new p,_.offX=e.titleoffsetX,_.offY=e.titleoffsetY-(h-this._mapTileH),_.texture=a.create(i,e.margin+(r+e.spacing)*d,e.margin+(h+e.spacing)*m,r,h),this._tileTexSetArr.push(_),_.gid=this._tileTexSetArr.length;this._tileSetArray.length>0?(e=this._currTileSet=this._tileSetArray.shift(),this._loader.once("complete",this,this.onTextureComplete),this._loader.load(e.image,"image",!1)):(this._currTileSet=null,this.initMap())},m.initMap=function(){var t=0;for(var i in this._animationDic){var r=this.getTexture(e.__parseInt(i)+1),h=this._animationDic[i];if(h.mAniIdArray.length>0)for(r.textureArray=[],r.durationTimeArray=h.mDurationTimeArray,r.animationKey=!0,t=0;t<h.mAniIdArray.length;t++){var a=this.getTexture(h.mAniIdArray[t]+1);r.textureArray.push(a)}}for(this._gridWidth=Math.floor(this._gridWidth/this._mapTileW)*this._mapTileW,this._gridHeight=Math.floor(this._gridHeight/this._mapTileH)*this._mapTileH,this._gridWidth<this._mapTileW&&(this._gridWidth=this._mapTileW),this._gridWidth<this._mapTileH&&(this._gridWidth=this._mapTileH),this._gridW=Math.ceil(this._width/this._gridWidth),this._gridH=Math.ceil(this._height/this._gridHeight),this._totalGridNum=this._gridW*this._gridH,t=0;t<this._gridH;t++){var s=[];this._gridArray.push(s);for(var n=0;n<this._gridW;n++)s.push(null)}for(var l=this._jsonData.layers,o=0;o<l.length;o++){var _=l[o];if(1==_.visible){var m=new c;m.init(_,this),this._mapSprite.addChild(m),this._layerArray.push(m)}}this.moveViewPort(this._rect.x,this._rect.y),null!=this._completeHandler&&this._completeHandler.run()},m.getTexture=function(t){return t<this._tileTexSetArr.length?this._tileTexSetArr[t]:null},m.getSprite=function(t){if(0<this._tileTexSetArr.length){var i=new d;i.initData(this,!0);var e=this._tileTexSetArr[t];if(null!=e&&null!=e.texture){if(e.animationKey){var r=new u;this._index++,r.setTileTextureSet(this._index.toString(),e),i.addAniSprite(r),i.addChild(r)}else i.graphics.drawTexture(e.texture,e.offX,e.offY,e.texture.width,e.texture.height);i.drawImageNum++}return i}return null},m.moveViewPort=function(t,i){this._x=-t,this._y=-i,this._rect.x=t,this._rect.y=i,this.updateViewPort()},m.changeViewPort=function(t,i,e,r){this._x=-t,this._y=-i,this._rect.x=t,this._rect.y=i,this._rect.width=e,this._rect.height=r,this.updateViewPort()},m.updateViewPort=function(){var t=this._paddingRect,i=this._rect.x-t.x,e=this._rect.y-t.y,r=this._rect.width+t.width+t.x,h=this._rect.height+t.height+t.y;this._mapRect.top=Math.floor(e/this._gridHeight),this._mapRect.bottom=Math.floor((e+h)/this._gridHeight),this._mapRect.left=Math.floor(i/this._gridWidth),this._mapRect.right=Math.floor((i+r)/this._gridWidth),this.clipViewPort(),this._mapLastRect.top=this._mapRect.top,this._mapLastRect.bottom=this._mapRect.bottom,this._mapLastRect.left=this._mapRect.left,this._mapLastRect.right=this._mapRect.right;for(var a,s=0;s<this._layerArray.length;s++)a=this._layerArray[s],a.updateGridPos()},m.clipViewPort=function(){var t=0,i=0,e=0,r=0;if(this._mapRect.left>this._mapLastRect.left){if(t=this._mapRect.left-this._mapLastRect.left,t>0)for(r=this._mapLastRect.left;r<this._mapLastRect.left+t;r++)for(e=this._mapLastRect.top;e<=this._mapLastRect.bottom;e++)this.hideGrid(r,e)}else if(i=this._mapLastRect.left-this._mapRect.left,i>0)for(r=this._mapRect.left;r<this._mapRect.left+i;r++)for(e=this._mapRect.top;e<=this._mapRect.bottom;e++)this.showGrid(r,e);if(this._mapRect.right>this._mapLastRect.right){if(i=this._mapRect.right-this._mapLastRect.right,i>0)for(r=this._mapLastRect.right+1;r<=this._mapLastRect.right+i;r++)for(e=this._mapRect.top;e<=this._mapRect.bottom;e++)this.showGrid(r,e)}else if(t=this._mapLastRect.right-this._mapRect.right,t>0)for(r=this._mapRect.right+1;r<=this._mapRect.right+t;r++)for(e=this._mapLastRect.top;e<=this._mapLastRect.bottom;e++)this.hideGrid(r,e);if(this._mapRect.top>this._mapLastRect.top){if(t=this._mapRect.top-this._mapLastRect.top,t>0)for(e=this._mapLastRect.top;e<this._mapLastRect.top+t;e++)for(r=this._mapLastRect.left;r<=this._mapLastRect.right;r++)this.hideGrid(r,e)}else if(i=this._mapLastRect.top-this._mapRect.top,i>0)for(e=this._mapRect.top;e<this._mapRect.top+i;e++)for(r=this._mapRect.left;r<=this._mapRect.right;r++)this.showGrid(r,e);if(this._mapRect.bottom>this._mapLastRect.bottom){if(i=this._mapRect.bottom-this._mapLastRect.bottom,i>0)for(e=this._mapLastRect.bottom+1;e<=this._mapLastRect.bottom+i;e++)for(r=this._mapRect.left;r<=this._mapRect.right;r++)this.showGrid(r,e)}else if(t=this._mapLastRect.bottom-this._mapRect.bottom,t>0)for(e=this._mapRect.bottom+1;e<=this._mapRect.bottom+t;e++)for(r=this._mapLastRect.left;r<=this._mapLastRect.right;r++)this.hideGrid(r,e)},m.showGrid=function(t,i){if(!(0>t||t>=this._gridW||0>i||i>=this._gridH)){var e,r=0,h=0,a=this._gridArray[i][t];if(null==a){a=this._gridArray[i][t]=[];var s=0,n=0,l=0,o=0,_=this._gridWidth,m=this._gridHeight;switch(this.orientation){case"isometric":s=Math.floor(t*_),n=Math.floor(t*_+_),l=Math.floor(i*m),o=Math.floor(i*m+m);var p=0,d=0,c=0,u=0;break;case"orthogonal":s=Math.floor(t*_/this._mapTileW),n=Math.floor((t*_+_)/this._mapTileW),l=Math.floor(i*m/this._mapTileH),o=Math.floor((i*m+m)/this._mapTileH);break;case"hexagonal":var g=2*this._mapTileH/3;s=Math.floor(t*_/this._mapTileW),n=Math.ceil((t*_+_)/this._mapTileW),l=Math.floor(i*m/g),o=Math.ceil((i*m+m)/g)}for(var f=null,y=0;y<this._layerArray.length;y++){f=this._layerArray[y],e=f.getDrawSprite(t,i),a.push(e);var T;switch(this._showGridKey&&(T="#",T+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)],T+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)],T+=this._colorArray[Math.floor(Math.random()*this._colorArray.length)]),this.orientation){case"isometric":var A=this.TileHeight/2,v=this.TileWidth/2,w=this._width/2;c=Math.floor(l/A),u=Math.floor(o/A),p=this._mapW+Math.floor((s-w)/v),d=this._mapW+Math.floor((n-w)/v);var x=(2*this._mapW,2*this._mapH);for(0>c&&(c=0),c>=x&&(c=x-1),0>u&&(o=0),u>=x&&(u=x-1),e.zOrder=this._totalGridNum*y+i*this._gridW+t,r=c;u>r;r++)for(h=0;r>=h;h++){var R=r-h,H=h,S=R-H+this._mapW;S>p&&d>=S&&f.drawTileTexture(e,R,H)&&e.drawImageNum++}break;case"orthogonal":case"hexagonal":switch(this._renderOrder){case"right-down":for(e.zOrder=y*this._totalGridNum+i*this._gridW+t,r=l;o>r;r++)for(h=s;n>h;h++)f.drawTileTexture(e,h,r)&&e.drawImageNum++;break;case"right-up":for(e.zOrder=y*this._totalGridNum+(this._gridH-1-i)*this._gridW+t,r=o-1;r>=l;r--)for(h=s;n>h;h++)f.drawTileTexture(e,h,r)&&e.drawImageNum++;break;case"left-down":for(e.zOrder=y*this._totalGridNum+i*this._gridW+(this._gridW-1-t),r=l;o>r;r++)for(h=n-1;h>=s;h--)f.drawTileTexture(e,h,r)&&e.drawImageNum++;break;case"left-up":for(e.zOrder=y*this._totalGridNum+(this._gridH-1-i)*this._gridW+(this._gridW-1-t),r=o-1;r>=l;r--)for(h=n-1;h>=s;h--)f.drawTileTexture(e,h,r)&&e.drawImageNum++}}e.haveAnimationKey||(e.autoSize=!0,e.cacheAsBitmap=!0,e.autoSize=!1),e.drawImageNum>0&&f.addChild(e),this._showGridKey&&e.graphics.drawRect(0,0,_,m,null,T)}}else for(r=0;r<a.length&&r<this._layerArray.length;r++){var W=this._layerArray[r];W&&a[r]&&(e=a[r],0==e.visible&&e.drawImageNum>0&&e.show())}}},m.hideGrid=function(t,i){if(!(0>t||t>=this._gridW||0>i||i>=this._gridH)){var e=this._gridArray[i][t];if(e)for(var r,h=0;h<e.length;h++)r=e[h],r.drawImageNum>0&&null!=r&&r.hide()}},m.getLayerObject=function(t,i){for(var e=null,r=0;r<this._layerArray.length&&(e=this._layerArray[r],e.layerName!=t);r++);return e?e.getObjectByName(i):null},m.destory=function(){this._orientation="orthogonal",this._jsonData=null;var t=0;this._gridArray=[];var i;for(t=0;t<this._tileTexSetArr.length;t++)i=this._tileTexSetArr[t],i&&i.clearAll();this._tileTexSetArr=[];var e;for(t=0;t<this._texArray.length;t++)e=this._texArray[t],e.destroy();this._texArray=[],this._width=0,this._height=0,this._mapW=0,this._mapH=0,this._mapTileW=0,this._mapTileH=0,this._rect.setTo(0,0,0,0);var r;for(t=0;t<this._layerArray.length;t++)r=this._layerArray[t],r.clearAll();this._layerArray=[],this._mapSprite&&(this._mapSprite.destroy(),this._mapSprite=null),this._jsonLoader=null,this._loader=null;var h=this._animationDic;for(var a in h)delete h[a];this._currTileSet=null,this._completeHandler=null,this._mapRect.clearAll(),this._mapLastRect.clearAll(),this._tileSetArray=[],this._gridWidth=450,this._gridHeight=450,this._gridW=0,this._gridH=0,this._x=0,this._y=0,this._index=0},m.mapSprite=function(){return this._mapSprite},m.getLayerByName=function(t){for(var i,e=0;e<this._layerArray.length;e++)if(i=this._layerArray[e],t==i.layerName)return i;return null},m.getLayerByIndex=function(t){return t<this._layerArray.length?this._layerArray[t]:null},h(0,m,"TileWidth",function(){return this._mapTileW}),h(0,m,"TileHeight",function(){return this._mapTileH}),h(0,m,"gridW",function(){return this._gridW}),h(0,m,"width",function(){return this._width}),h(0,m,"height",function(){return this._height}),h(0,m,"viewPortX",function(){return this._rect.x}),h(0,m,"viewPortY",function(){return this._rect.y}),h(0,m,"MapWidth",function(){return this._mapW}),h(0,m,"MapHeight",function(){return this._mapH}),h(0,m,"y",function(){return this._y}),h(0,m,"x",function(){return this._x}),h(0,m,"gridWidth",function(){return this._gridWidth}),h(0,m,"gridHeight",function(){return this._gridHeight}),h(0,m,"gridH",function(){return this._gridH}),h(0,m,"orientation",function(){return this._orientation}),h(0,m,"renderOrder",function(){return this._renderOrder}),t.ORIENTATION_ORTHOGONAL="orthogonal",t.ORIENTATION_ISOMETRIC="isometric",t.ORIENTATION_HEXAGONAL="hexagonal",t.RENDERORDER_RIGHTDOWN="right-down",t.RENDERORDER_RIGHTUP="right-up",t.RENDERORDER_LEFTDOWN="left-down",t.RENDERORDER_LEFTUP="left-up",t.__init$=function(){i=function(){function t(){this.left=0,this.top=0,this.right=0,this.bottom=0}r(t,"");var i=t.prototype;return i.clearAll=function(){this.left=this.top=this.right=this.bottom=0},t}(),s=function(){function t(){this.mAniIdArray=[],this.mDurationTimeArray=[],this.mTileTexSetArr=[]}return r(t,""),t}(),l=function(){function t(){this.firstgid=0,this.image="",this.imageheight=0,this.imagewidth=0,this.margin=0,this.name=0,this.properties=null,this.spacing=0,this.tileheight=0,this.tilewidth=0,this.titleoffsetX=0,this.titleoffsetY=0}r(t,"");var i=t.prototype;return i.init=function(t){this.firstgid=t.firstgid,this.image=t.image,this.imageheight=t.imageheight,this.imagewidth=t.imagewidth,this.margin=t.margin,this.name=t.name,this.properties=t.properties,this.spacing=t.spacing,this.tileheight=t.tileheight,this.tilewidth=t.tilewidth;var i=t.tileoffset;i&&(this.titleoffsetX=i.x,this.titleoffsetY=i.y)},t}()},t}()),p=function(){function t(){this.gid=-1,this.texture=null,this.offX=0,this.offY=0,this.textureArray=null,this.durationTimeArray=null,this.animationKey=!1,this._spriteNum=0,this._aniDic=null,this._frameIndex=0,this._time=0,this._interval=0,this._preFrameTime=0}r(t,"laya.map.TileTexSet");var i=t.prototype;return i.addAniSprite=function(t,i){if(null==this._aniDic&&(this._aniDic={}),0==this._spriteNum&&(e.timer.frameLoop(3,this,this.animate),this._preFrameTime=s.now(),this._frameIndex=0,this._time=0,this._interval=0),this._spriteNum++,this._aniDic[t]=i,this.textureArray&&this._frameIndex<this.textureArray.length){var r=this.textureArray[this._frameIndex];this.drawTexture(i,r)}},i.animate=function(){if(this.textureArray&&this.textureArray.length>0&&this.durationTimeArray&&this.durationTimeArray.length>0){var t=s.now();this._interval=t-this._preFrameTime,this._preFrameTime=t,this._time+=this._interval;var i=this.durationTimeArray[this._frameIndex];if(this._time>i){this._time-=i,this._frameIndex++,(this._frameIndex>=this.durationTimeArray.length||this._frameIndex>=this.textureArray.length)&&(this._frameIndex=0);var e,r=this.textureArray[this._frameIndex];for(var h in this._aniDic)e=this._aniDic[h],this.drawTexture(e,r)}}},i.drawTexture=function(t,i){t.graphics.clear(),t.graphics.drawTexture(i.texture,i.offX,i.offY,i.texture.width,i.texture.height)},i.removeAniSprite=function(t){this._aniDic&&this._aniDic[t]&&(delete this._aniDic[t],this._spriteNum--,0==this._spriteNum&&e.timer.clear(this,this.animate))},i.showDebugInfo=function(){var t=null;return this._spriteNum>0&&(t="TileTextureSet::gid:"+this.gid.toString()+" 动画数:"+this._spriteNum.toString()),t},i.clearAll=function(){this._spriteNum>0&&console.log("error::"+this.showDebugInfo()),this.gid=-1,this.texture&&(this.texture.destroy(),this.texture=null),this.offX=0,this.offY=0,this.textureArray=null,this.durationTimeArray=null,this.animationKey=!1,this._spriteNum=0,this._aniDic=null,this._frameIndex=0,this._preFrameTime=0,this._time=0,this._interval=0},t}(),d=function(t){function i(){this.relativeX=0,this.relativeY=0,this.isAloneObjectKey=!1,this.haveAnimationKey=!1,this.aniSpriteArray=null,this.drawImageNum=0,this._map=null,i.__super.call(this)}r(i,"laya.map.GridSprite",t);var e=i.prototype;return e.initData=function(t,i){void 0===i&&(i=!1),this._map=t,this.isAloneObjectKey=i},e.addAniSprite=function(t){null==this.aniSpriteArray&&(this.aniSpriteArray=[]),this.aniSpriteArray.push(t)},e.show=function(){if(!this.visible){if(this.visible=!0,null==this.aniSpriteArray)return;for(var t,i=0;i<this.aniSpriteArray.length;i++)t=this.aniSpriteArray[i],t.show()}},e.hide=function(){if(this.visible){if(this.visible=!1,null==this.aniSpriteArray)return;for(var t,i=0;i<this.aniSpriteArray.length;i++)t=this.aniSpriteArray[i],t.hide()}},e.updatePos=function(){this.isAloneObjectKey?(this._map&&(this.x=this.relativeX-this._map.viewPortX,this.y=this.relativeY-this._map.viewPortY),this.x<0||this.x>s.width||this.y<0||this.y>s.height?this.hide():this.show()):this._map&&(this.x=this.relativeX-this._map.viewPortX,this.y=this.relativeY-this._map.viewPortY)},e.clearAll=function(){if(this._map&&(this._map=null),this.visible=!1,null!=this.aniSpriteArray){for(var t,i=0;i<this.aniSpriteArray.length;i++)t=this.aniSpriteArray[i],t.clearAll();this.destroy(),this.relativeX=0,this.relativeY=0,this.haveAnimationKey=!1,this.aniSpriteArray=null,this.drawImageNum=0}},i}(n),c=function(t){function i(){this._map=null,this._mapData=null,this._tileWidthHalf=0,this._tileHeightHalf=0,this._mapWidthHalf=0,this._mapHeightHalf=0,this._gridSpriteArray=[],this._objDic=null,this.layerName=null,i.__super.call(this),this._tempMapPos=new l}r(i,"laya.map.MapLayer",t);var e=i.prototype;return e.init=function(t,i){this._map=i,this._mapData=t.data;var e=(t.height,t.width,i.TileWidth),r=i.TileHeight;switch(this.layerName=t.name,this.alpha=t.opacity,this._tileWidthHalf=e/2,this._tileHeightHalf=r/2,this._mapWidthHalf=this._map.width/2-this._tileWidthHalf,this._mapHeightHalf=this._map.height/2,t.type){case"tilelayer":break;case"objectgroup":var h=t.objects;h.length>0&&(this._objDic={});for(var a,s=0;s<h.length;s++)if(a=h[s],1==a.visible){var n=i.getSprite(a.gid);null!=n&&(n.x=n.relativeX=a.x,n.y=n.relativeY=a.y-i.TileHeight,this.addChild(n),this._gridSpriteArray.push(n),this._objDic[a.name]=n)}}},e.getObjectByName=function(t){return this._objDic?this._objDic[t]:null},e.getTileData=function(t,i){if(i>=0&&i<this._map.MapHeight&&t>=0&&t<this._map.MapWidth){var e=i*this._map.MapWidth+t,r=this._mapData;if(null!=r&&e<r.length)return r[e]}return 0},e.getScreenPositionByTilePos=function(t,i,e){if(e)switch(this._map.orientation){case"isometric":e.x=this._map.width/2-(i-t)*this._tileWidthHalf-this._map.viewPortX,e.y=(i+t)*this._tileHeightHalf-this._map.viewPortY;break;case"orthogonal":e.x=t*this._map.TileWidth-this._map.viewPortX,e.y=i*this._map.TileHeight-this._map.viewPortY;break;case"hexagonal":t=Math.floor(t),i=Math.floor(i);var r=2*this._map.TileHeight/3;e.x=(t*this._map.TileWidth+i%2*this._tileWidthHalf)%this._map.gridWidth-this._map.viewPortX,e.y=i*r%this._map.gridHeight-this._map.viewPortY}},e.getTileDataByScreenPos=function(t,i){var e=0;return this.getTilePositionByScreenPos(t,i,this._tempMapPos)&&(e=this.getTileData(Math.floor(this._tempMapPos.x),Math.floor(this._tempMapPos.y))),e},e.getTilePositionByScreenPos=function(t,i,e){t+=this._map.viewPortX,i+=this._map.viewPortY;var r=this._map.TileWidth,h=this._map.TileHeight,a=0,s=0;switch(this._map.orientation){case"isometric":var n=t-this._map.width/2,l=i;return a=-(n/r-l/h),s=n/r+l/h,e&&(e.x=s,e.y=a),!0;case"orthogonal":return s=t/this._map.TileWidth,a=i/this._map.TileHeight,e&&(e.x=s,e.y=a),!0;case"hexagonal":var o=2*this._map.TileHeight/3;a=i/o,s=(t-a%2*this._tileWidthHalf)/this._map.TileWidth,e&&(e.x=s,e.y=a)}return!1},e.getDrawSprite=function(t,i){var e=new d;return e.relativeX=t*this._map.gridWidth,e.relativeY=i*this._map.gridHeight,e.initData(this._map),this._gridSpriteArray.push(e),e},e.updateGridPos=function(){for(var t,i=0;i<this._gridSpriteArray.length;i++)t=this._gridSpriteArray[i],(t.visible||t.isAloneObjectKey)&&t.drawImageNum>0&&t.updatePos()},e.drawTileTexture=function(t,i,e){if(e>=0&&e<this._map.MapHeight&&i>=0&&i<this._map.MapWidth){var r=e*this._map.MapWidth+i,h=this._mapData;if(null!=h&&r<h.length&&0!=h[r]){var a=this._map.getTexture(h[r]);if(a){var s=0,n=0,l=a.texture;switch(this._map.orientation){case"orthogonal":s=i*this._map.TileWidth%this._map.gridWidth,n=e*this._map.TileHeight%this._map.gridHeight;break;case"isometric":s=(this._mapWidthHalf+(i-e)*this._tileWidthHalf)%this._map.gridWidth,n=(i+e)*this._tileHeightHalf%this._map.gridHeight;break;case"hexagonal":var o=2*this._map.TileHeight/3;s=(i*this._map.TileWidth+e%2*this._tileWidthHalf)%this._map.gridWidth,n=e*o%this._map.gridHeight}if(a.animationKey){var _=new u;_.x=s,_.y=n,_.setTileTextureSet(r.toString(),a),t.addAniSprite(_),t.addChild(_),t.haveAnimationKey=!0}else t.graphics.drawTexture(a.texture,s+a.offX,n+a.offY,l.width,l.height);return!0}}}return!1},e.clearAll=function(){this._map=null,this._mapData=null,this._tileWidthHalf=0,this._tileHeightHalf=0,this._mapWidthHalf=0,this._mapHeightHalf=0,this.layerName=null;var t=0;if(this._objDic){for(var i in this._objDic)delete this._objDic[i];this._objDic=null}var e;for(t=0;t<this._gridSpriteArray.length;t++)e=this._gridSpriteArray[t],e.clearAll();this._tempMapPos=null},i}(n),u=function(t){function i(){this._tileTextureSet=null,this._aniName=null,i.__super.call(this)}r(i,"laya.map.TileAniSprite",t);var e=i.prototype;return e.setTileTextureSet=function(t,i){this._aniName=t,this._tileTextureSet=i,i.addAniSprite(this._aniName,this)},e.show=function(){this._tileTextureSet.addAniSprite(this._aniName,this)},e.hide=function(){this._tileTextureSet.removeAniSprite(this._aniName)},e.clearAll=function(){this._tileTextureSet.removeAniSprite(this._aniName),this.destroy(),this._tileTextureSet=null,this._aniName=null},i}(n);e.__init([m])}(window,document,Laya);