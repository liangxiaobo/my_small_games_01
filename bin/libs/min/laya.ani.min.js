!function(t,e,i){var a=(i.un,i.uns,i["static"],i["class"]),n=i.getset,r=i.__newvec,s=laya.utils.Byte,h=laya.display.Sprite,o=(laya.events.Event,laya.net.Loader),l=laya.maths.Matrix,u=laya.net.URL,c=laya.utils.Stat,d=laya.events.EventDispatcher,p=laya.display.Graphics,_=laya.utils.Handler,m=laya.resource.Texture,f=laya.utils.Browser,g=(laya.maths.Point,laya.maths.MathUtil),y=(function(){function t(){}return a(t,"laya.ani.AnimationState"),t.stopped=0,t.paused=1,t.playing=2,t}(),function(){function t(){this.textureArray=[],this.displayDataArray=[],this.currTexture=null,this.currDisplayData=null,this._parentMatrix=null}a(t,"laya.ani.bone.BoneSlot");var e=t.prototype;return e.addSprite=function(t,e){this.textureArray.push(t),this.displayDataArray.push(e),e.name,this.showSpriteByIndex(0)},e.showSpriteByIndex=function(t){t>-1&&t<this.textureArray.length?this.currTexture=this.textureArray[t]:this.currTexture=null,t>-1&&t<this.displayDataArray.length?this.currDisplayData=this.displayDataArray[t]:this.currDisplayData=null},e.replaceSkin=function(t){this.currTexture=t},e.setParentMatrix=function(t){this._parentMatrix=t},e.draw=function(t){if(null!=this.currTexture&&null!=this.currDisplayData){var e=this.currTexture;if(t){var i=this.getDisplayMatrix();if(i){l.mul(i,this._parentMatrix,l.TEMP);var a=new l;l.TEMP.copy(a),t.drawTexture(e,-e.sourceWidth/2,-e.sourceHeight/2,e.sourceWidth,e.sourceHeight,a)}}}},e.drawBonePoint=function(t){t&&this._parentMatrix&&t.drawCircle(this._parentMatrix.tx,this._parentMatrix.ty,5,"#ff0000")},e.getDisplayMatrix=function(){return this.currDisplayData?this.currDisplayData.transform.getMatrix():null},t}()),x=function(){function t(){this.name=null,this.slotArr=[]}a(t,"laya.ani.bone.SkinData");var e=t.prototype;return e.initData=function(t){this.name=t.name;for(var e,i,a=t.slot,n=0;n<a.length;n++)i=a[n],e=new I,e.initData(i),this.slotArr.push(e)},t}(),v=function(){function t(){this.name=null,this.type=null,this.transform=null,this.pivot=null,this.uvs=null,this.triangles=null,this.weights=null,this.vertices=null,this.slotPos=null,this.bonePose=null,this.edges=null,this.userEdges=null}a(t,"laya.ani.bone.SkinSlotDisplayData");var e=t.prototype;return e.initData=function(t){this.name=t.name,this.type=t.type,this.transform=new A,this.transform.initData(t.transform)},t}(),I=function(){function t(){this.name=null,this.displayArr=[]}a(t,"laya.ani.bone.SlotData");var e=t.prototype;return e.initData=function(t){this.name=t.name;for(var e,i,a=t.display,n=0;n<a.length;n++)i=a[n],e=new v,e.initData(i),this.displayArr.push(e)},t}(),A=function(){function t(){this.skX=0,this.skY=0,this.scX=1,this.scY=1,this.x=0,this.y=0,this.mMatrix=null}a(t,"laya.ani.bone.Transform");var e=t.prototype;return e.initData=function(t){void 0!=t.x&&(this.x=t.x),void 0!=t.y&&(this.y=t.y),void 0!=t.skX&&(this.skX=t.skX),void 0!=t.skY&&(this.skY=t.skY),void 0!=t.scX&&(this.scX=t.scX),void 0!=t.scY&&(this.scY=t.scY)},e.getMatrix=function(){var t;if(t=this.mMatrix?this.mMatrix:this.mMatrix=new l,t.a=Math.cos(this.skY),0!=this.skX||0!=this.skY){var e=this.skX*Math.PI/180,i=Math.cos(e),a=Math.sin(e);t.setTo(this.scX*i,this.scX*a,this.scY*-a,this.scY*i,this.x,this.y)}else t.setTo(this.scX,this.skX,this.skY,this.scY,this.x,this.y);return t},t}(),F=function(t){function e(t){this._templet=null,this._currentTime=NaN,this._currentFrameTime=NaN,this._duration=NaN,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=NaN,this._startPlayLoopCount=NaN,this._currentAnimationClipIndex=0,this._currentKeyframeIndex=0,this._paused=!1,this._cacheFrameRate=0,this._cacheFrameRateInterval=NaN,this.playbackRate=1,this.isCache=!0,this.returnToZeroStopped=!0,e.__super.call(this),void 0===t&&(t=60),this._currentAnimationClipIndex=-1,this._currentKeyframeIndex=-1,this._currentTime=0,this._duration=Number.MAX_VALUE,this._stopWhenCircleFinish=!1,this._elapsedPlaybackTime=0,this._startPlayLoopCount=-1,this._cacheFrameRate=t,this._cacheFrameRateInterval=1e3/this._cacheFrameRate}a(e,"laya.ani.AnimationPlayer",t);var i=e.prototype;return i.play=function(t,e,i){void 0===t&&(t=0),void 0===e&&(e=1),void 0===i&&(i=Number.MAX_VALUE),this._currentTime=0,this._elapsedPlaybackTime=0,this.playbackRate=e,this._duration=i,this._paused=!1,this._currentAnimationClipIndex=t,this._currentKeyframeIndex=0,this._startPlayLoopCount=c.loopCount,this.event("played")},i.stop=function(t){void 0===t&&(t=!0),t?(this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,this.event("stopped")):this._stopWhenCircleFinish=!0},i.update=function(t){if(-1!==this._currentAnimationClipIndex&&!this._paused&&this._templet&&this._templet.loaded){var e=0;this._startPlayLoopCount!==c.loopCount&&(e=t*this.playbackRate,this._elapsedPlaybackTime+=e);var i=this._templet.getAniDuration(this._currentAnimationClipIndex);if(0!==this._duration&&this._elapsedPlaybackTime>=this._duration||0===this._duration&&this._elapsedPlaybackTime>=i)return this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,void this.event("stopped");for(e+=this._currentTime;e>=i;){if(this._stopWhenCircleFinish)return this._currentAnimationClipIndex=this._currentKeyframeIndex=-1,this._stopWhenCircleFinish=!1,void this.event("stopped");e-=i}this.currentTime=e}},n(0,i,"currentAnimationClipIndex",function(){return this._currentAnimationClipIndex}),n(0,i,"templet",function(){return this._templet},function(t){0===!this.State&&this.stop(!0),this._templet=t}),n(0,i,"currentKeyframeIndex",function(){return this._currentKeyframeIndex}),n(0,i,"cacheFrameRate",function(){return this._cacheFrameRate}),n(0,i,"currentFrameTime",function(){return this._currentFrameTime}),n(0,i,"currentTime",function(){return this._currentTime},function(t){this._currentTime=t,this._currentKeyframeIndex=Math.floor(this._currentTime%this._templet.getAniDuration(this._currentAnimationClipIndex)/this._cacheFrameRateInterval),this._currentFrameTime=this._currentKeyframeIndex*this._cacheFrameRateInterval}),n(0,i,"State",function(){return-1===this._currentAnimationClipIndex?0:this._paused?1:2}),n(0,i,"paused",function(){return this._paused},function(t){this._paused=t,t&&this.event("paused")}),e}(d),D=function(t){function e(){this._aniMap={},this.unfixedLastAniIndex=-1,this._loaded=!1,this._animationDatasCache=[],e.__super.call(this),this._anis=new Array}a(e,"laya.ani.KeyframesAniTemplet",t);var i=e.prototype;return i.parse=function(t,i){var a,n=0,r=0,h=0,o=0,l=0,u=new s(t),c=(u.readUTFString(),u.readUTFString(),u.readUTFString().split("\n")),d=u.getUint8(),p=u.getUint32(),_=u.getUint32();p>0&&(a=t.slice(p,_));var m=new s(a);for(_>0&&(this._publicExtData=t.slice(_,t.byteLength)),this._useParent=!!u.getUint8(),this._anis.length=d,n=0;d>n;n++){var f=this._anis[n]={};f.nodes=new Array;var g=f.name=c[u.getUint8()];this._aniMap[g]=n,f.bone3DMap={},f.playTime=u.getFloat32();var y=f.nodes.length=u.getUint8();for(f.totalKeyframesLength=0,r=0;y>r;r++){var x=f.nodes[r]={};x.childs=[];var v=u.getInt16();v>=0&&(x.name=c[v],f.bone3DMap[x.name]=r),x.keyFrame=new Array,x.parentIndex=u.getInt16(),x.parent=f.nodes[x.parentIndex];var I=!!u.getUint8(),A=u.getUint32();m.pos=A;var F=x.keyframeWidth=m.getUint16();if(f.totalKeyframesLength+=F,I)for(x.interpolationMethod=[],x.interpolationMethod.length=F,h=0;F>h;h++)x.interpolationMethod[h]=e.interpolation[m.getUint8()];null!=x.parent&&x.parent.childs.push(x);var D=u.getUint16();D>0&&(x.extenData=t.slice(u.pos,u.pos+D),u.pos+=D);var T=u.getUint16();x.keyFrame.length=T;var C=0;for(h=0,o=T;o>h;h++){var k=x.keyFrame[h]={};for(k.duration=u.getFloat32(),k.startTime=C,k.data=new Float32Array(F),k.dData=new Float32Array(F),k.nextData=new Float32Array(F),l=0;F>l;l++)k.data[l]=u.getFloat32(),k.data[l]>-1e-8&&k.data[l]<1e-8&&(k.data[l]=0);C+=k.duration}x.playTime=C,this._calculateKeyFrame(x,T,F),this._calculateKeyFrameIndex(x,i)}}this._loaded=!0,this.event("loaded",this)},i._calculateKeyFrame=function(t,e,i){var a=t.keyFrame;a[e]=a[0];for(var n=0;e>n;n++)for(var r=a[n],s=0;i>s;s++)r.dData[s]=0===r.duration?0:(a[n+1].data[s]-r.data[s])/r.duration,r.nextData[s]=a[n+1].data[s];a.length--},i._calculateKeyFrameIndex=function(t,e){var i=1e3/e;t.frameCount=Math.floor(t.playTime/i),t.fullFrame=new Uint16Array(t.frameCount+1);for(var a=0,n=t.keyFrame.length;n>a;a++){var r=t.keyFrame[a],s=r.startTime,h=s+r.duration+i;do t.fullFrame[Math.floor(s/i+.5)]=a,s+=i;while(h>=s)}},i.getAnimationCount=function(){return this._anis.length},i.getAnimation=function(t){return this._anis[t]},i.getAniDuration=function(t){return this._anis[t].playTime},i.getNodes=function(t){return this._anis[t].nodes},i.getNodeIndexWithName=function(t,e){return this._anis[t].bone3DMap[e]},i.getNodeCount=function(t){return this._anis[t].nodes.length},i.getTotalkeyframesLength=function(t){return this._anis[t].totalKeyframesLength},i.getPublicExtData=function(){return this._publicExtData},i.getAnimationDataWithCache=function(t,e,i){var a=t[e];return a?a[i]:null},i.setAnimationDataWithCache=function(t,e,i,a){var n=t[e];n||(n=t[e]=[],n.length=30),n[i]||(n[i]=new Float32Array(a.length)),n[i].set(a,0)},i.getOriginalData=function(t,e,i,a){for(var n=this._anis[t],r=n.nodes,s=0,h=0,o=r.length,l=0;o>h;h++){var u,c=r[h];u=c.keyFrame[c.fullFrame[i]],c.dataOffset=l;var d=a-u.startTime;for(s=0;s<c.keyframeWidth;)s+=c.interpolationMethod[s](c,s,e,l+s,u.data,d,u.dData,u.duration,u.nextData);l+=c.keyframeWidth}},i.getNodesCurrentFrameIndex=function(t,e){var i=this._anis[t],a=i.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(a.length),this.unfixedCurrentTimes=new Float32Array(a.length),this.unfixedLastAniIndex=t);for(var n=0,r=a.length;r>n;n++){var s=a[n];for(e<this.unfixedCurrentTimes[n]&&(this.unfixedCurrentFrameIndexes[n]=0),this.unfixedCurrentTimes[n]=e;this.unfixedCurrentFrameIndexes[n]<s.keyFrame.length&&!(s.keyFrame[this.unfixedCurrentFrameIndexes[n]].startTime>this.unfixedCurrentTimes[n]);)this.unfixedCurrentFrameIndexes[n]++;this.unfixedCurrentFrameIndexes[n]--}return this.unfixedCurrentFrameIndexes},i.getOriginalDataUnfixedRate=function(t,e,i){var a=this._anis[t],n=a.nodes;t!==this.unfixedLastAniIndex&&(this.unfixedCurrentFrameIndexes=new Uint32Array(n.length),this.unfixedCurrentTimes=new Float32Array(n.length),this.unfixedKeyframes=r(n.length),this.unfixedLastAniIndex=t);for(var s=0,h=0,o=n.length,l=0;o>h;h++){var u=n[h];for(i<this.unfixedCurrentTimes[h]&&(this.unfixedCurrentFrameIndexes[h]=0),this.unfixedCurrentTimes[h]=i;this.unfixedCurrentFrameIndexes[h]<u.keyFrame.length&&!(u.keyFrame[this.unfixedCurrentFrameIndexes[h]].startTime>this.unfixedCurrentTimes[h]);)this.unfixedKeyframes[h]=u.keyFrame[this.unfixedCurrentFrameIndexes[h]],this.unfixedCurrentFrameIndexes[h]++;var c=this.unfixedKeyframes[h];u.dataOffset=l;var d=i-c.startTime;for(s=0;s<u.keyframeWidth;)s+=u.interpolationMethod[s](u,s,e,l+s,c.data,d,c.dData,c.duration,c.nextData);l+=u.keyframeWidth}},n(0,i,"loaded",function(){return this._loaded}),e._LinearInterpolation_0=function(t,e,i,a,n,r,s,h,o){return i[a]=n[e]+r*s[e],1},e._QuaternionInterpolation_1=function(t,e,i,a,n,r,s,h,o){return g.slerpQuaternionArray(n,e,o,e,r/h,i,a),4},e._AngleInterpolation_2=function(t,e,i,a,n,r,s,h,o){return 0},e._RadiansInterpolation_3=function(t,e,i,a,n,r,s,h,o){return 0},e._Matrix4x4Interpolation_4=function(t,e,i,a,n,r,s,h,o){for(var l=0;16>l;l++,e++)i[a+l]=n[e]+r*s[e];return 16},e.interpolation=[e._LinearInterpolation_0,e._QuaternionInterpolation_1,e._AngleInterpolation_2,e._RadiansInterpolation_3,e._Matrix4x4Interpolation_4],e}(d),T=function(t){function e(t,i,a){this._mainTexture=null,this._textureJson=null,this._graphicsCache=[],this.srcBoneMatrixArr=[],this.boneSlotDic={},this.boneSlotArray=[],this.skinDataArray=[],this.subTextureDic={},this._rate=60,e.__super.call(this),void 0===a&&(a=60),t&&i&&this.parseData(i,t,a)}a(e,"laya.ani.bone.Templet",t);var i=e.prototype;return i.parseData=function(t,e,i){void 0===i&&(i=60),this._mainTexture=t,this._rate=i,this.parse(e,i)},i.buildArmature=function(){return new C(this)},i.parse=function(e,i){t.prototype.parse.call(this,e,i),this._parsePublicExtData(),this.event("complete",this)},i._parsePublicExtData=function(){var t=0,e=0,i=0,a=0;for(t=0,a=this.getAnimationCount();a>t;t++)this._graphicsCache.push([]);var n=new s(this.getPublicExtData()),r=0,h=0,o=0,l=0,u=0,c=0,d=0,p=0,_=n.getUint8(),f=n.readUTFString(),g=f.split("\n");for(t=0;_>t;t++)f=g[t],r=n.getFloat32(),h=n.getFloat32(),o=n.getFloat32(),l=n.getFloat32(),u=n.getFloat32(),c=n.getFloat32(),d=n.getFloat32(),p=n.getFloat32(),this.subTextureDic[f]=m.create(this._mainTexture,r,h,o,l,-u,-c,d,p);var F=(n.getUint16(),n.getUint16(),this.getNodes(0)),D=F.length,T=this.srcBoneMatrixArr;for(t=0;D>t;t++){var C=new A;C.scX=n.getFloat32(),C.skX=n.getFloat32(),C.skY=n.getFloat32(),C.scY=n.getFloat32(),C.x=n.getFloat32(),C.y=n.getFloat32(),T.push(C)}var k=n.getInt16();for(t=0;k>t;t++){var b=new y,U=(n.readUTFString(),n.readUTFString());n.getInt16();this.boneSlotDic[U]=b,this.boneSlotArray.push(b)}var w=n.readUTFString(),M=w.split("\n"),S=0,P=n.getUint8();for(t=0;P>t;t++){var N=new x;N.name=M[S++];var L=n.getUint8();for(e=0;L>e;e++){var X=new I;X.name=M[S++];var Y=n.getUint8();for(i=0;Y>i;i++){var K=new v;K.name=M[S++],K.transform=new A,K.transform.scX=n.getFloat32(),K.transform.skX=n.getFloat32(),K.transform.skY=n.getFloat32(),K.transform.scY=n.getFloat32(),K.transform.x=n.getFloat32(),K.transform.y=n.getFloat32(),X.displayArr.push(K)}N.slotArr.push(X)}this.skinDataArray.push(N)}},i.getGrahicsDataWithCache=function(t,e){return this._graphicsCache[t][e]},i.setGrahicsDataWithCache=function(t,e,i){console.log("aniIndex:"+t.toString()+" frameIndex:"+e.toString()),this._graphicsCache[t][e]=i},i.destory=function(){},i.getAniNameByIndex=function(t){var e=this.getAnimation(t);return e?e.name:null},n(0,i,"rate",function(){return this._rate}),n(0,i,"textureWidth",function(){return this._mainTexture?this._mainTexture.sourceWidth:0}),n(0,i,"textureHeight",function(){return this._mainTexture?this._mainTexture.sourceHeight:0}),e}(D),C=function(t){function e(t){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray=[],this._lastTime=0,this._currAniName=null,this._currAniIndex=-1,this._pause=!1,this._aniClipIndex=-1,this._clipIndex=-1,e.__super.call(this),this._tempTransform=new A,t&&this.init(t,t.rate)}a(e,"laya.ani.bone.Skeleton",t);var n=e.prototype;return n.init=function(t,e){this._templet=t,this._player=new F(e),this._player.templet=t,this._player.play(),this.parseSrcBoneMatrix(),this._lastTime=f.now(),i.stage.frameLoop(1,this,this.update,null,!0)},n.parseSrcBoneMatrix=function(){for(var t=this._templet.getNodeCount(0),e=0;t>e;e++)this._boneMatrixArray.push(new l);this.showSkinByIndex(0)},n.update=function(){if(!this._pause){var t=i.stage.now;if(this._player.update(t-this._lastTime),this._lastTime=t,this._aniClipIndex=this._player.currentAnimationClipIndex,this._clipIndex=this._player.currentKeyframeIndex,-1!=this._aniClipIndex){var e=this._templet.getGrahicsDataWithCache(this._aniClipIndex,this._clipIndex);return e?void(this.graphics=e):void this.createGraphics()}}},n.createGraphics=function(){var t=this._templet.getNodes(this._aniClipIndex),e=t.length;this._curOriginalData||(this._curOriginalData=new Float32Array(this._templet.getTotalkeyframesLength(0))),this._templet.getOriginalData(this._aniClipIndex,this._curOriginalData,this._clipIndex,this._player.currentFrameTime);var i,a,n,r,s,h=0,o=0,u=0;for(o=0;e>o;o++){a=this._boneMatrixArray[o],h=6*o,s=this._templet.srcBoneMatrixArr[o],this._tempTransform.scX=s.scX*this._curOriginalData[h],this._tempTransform.skX=s.skX+this._curOriginalData[h+1],this._tempTransform.skY=s.skY+this._curOriginalData[h+2],this._tempTransform.scY=s.scY*this._curOriginalData[h+3],this._tempTransform.x=s.x+this._curOriginalData[h+4],this._tempTransform.y=s.y+this._curOriginalData[h+5],r=this._tempTransform.getMatrix();var c=t[o];-1!=c.parentIndex?(i=this._boneMatrixArray[c.parentIndex],l.mul(r,i,a)):r.copy(a),n=this._templet.boneSlotDic[c.name],n&&n.setParentMatrix(a)}var d;for(this.graphics=d=new p,o=0,u=this._templet.boneSlotArray.length;u>o;o++)n=this._templet.boneSlotArray[o],n.draw(d);this._templet.setGrahicsDataWithCache(this._aniClipIndex,this._clipIndex,d)},n.getAnimNum=function(){return this._templet.getAnimationCount()},n.getAniNameByIndex=function(t){return this._templet.getAniNameByIndex(t)},n.getSlotByName=function(t){return null},n.showSkinByIndex=function(t){if(t<this._templet.skinDataArray.length){var e,i,a;e=this._templet.skinDataArray[t];for(var n=0,r=e.slotArr.length;r>n;n++){i=e.slotArr[n];for(var s=this._templet.boneSlotDic[i.name],h=0;h<i.displayArr.length;h++){a=i.displayArr[h];var o=this._templet.subTextureDic[a.name];s.addSprite(o,a)}}}},n.gotoAndPlay=function(t,e){void 0===e&&(e=Number.MAX_VALUE);for(var i=0,a=this._templet.getAnimationCount();a>i;i++){var n=this._templet.getAnimation(i);if(n&&t==n.name)return void this.gotoAndPlayByIndex(i,e)}},n.gotoAndPlayByIndex=function(t,e){void 0===e&&(e=Number.MAX_VALUE),t>-1&&t<this.getAnimNum()&&this._currAniIndex!=t&&(this._currAniIndex=t,this._player.play(t,1,e))},n.play=function(){-1==this._currAniIndex&&this.getAnimNum()>0&&(this._currAniIndex=0,this.gotoAndPlayByIndex(this._currAniIndex)),this._pause=!1},n.stop=function(){this._pause=!0},n.destory=function(){this._templet=null,this._player=null,this._curOriginalData=null,this._boneMatrixArray.length=0,this._lastTime=0,i.timer.clear(this,this.update)},n.stAnimName=function(t){this.gotoAndPlay(t),this.stop()},e}(h);(function(t){function e(){this.interval=30,this._start=0,this._Pos=0,this._data=null,this._curIndex=0,this._playIndex=0,this._playing=!1,this._ended=!0,this._frameCount=0,this._ids=null,this._idOfSprite=null,this.basePath=null,e.__super.call(this),this._ids={},this._idOfSprite=[],this._reset(),this._playing=!1}a(e,"laya.ani.swf.MovieClip",t);var r=e.prototype;return r.update=function(){this._data&&this._playing&&(this._playIndex++,this._playIndex>=this.totalFrames&&(this._playIndex=0),this._parse(this._playIndex))},r.stop=function(){this._playing=!1,i.timer.clear(this,this.update)},r.gotoStop=function(t){this.stop(),this._displayFrame(t)},r.clear=function(){this._idOfSprite.length=0,this.removeChildren(),this.graphics=null},r.play=function(t){void 0===t&&(t=-1),this._displayFrame(t),this._playing=!0,i.timer.loop(this.interval,this,this.update,null,!0)},r._displayFrame=function(t){void 0===t&&(t=-1),-1!=t&&(this._curIndex>t&&this._reset(),this._parse(t))},r._reset=function(t){void 0===t&&(t=!0),t&&1!=this._curIndex&&this.removeChildren(),this._curIndex=-1,this._Pos=this._start},r._parse=function(t){var i,a,n,r=0,s=0,o=0,u=0,c=!1,d=this._idOfSprite,p=this._data;for(this._ended&&this._reset(),p.pos=this._Pos,this._ended=!1,this._playIndex=t,this._curIndex>=t&&(this._curIndex=-1);this._curIndex<=t&&!this._ended;)switch(s=p.getUint16()){case 12:if(r=p.getUint16(),o=this._ids[p.getUint16()],this._Pos=p.pos,p.pos=o,0==(u=p.getUint8())){var _=p.getUint16();if(a=d[r],!a){a=d[r]=new h;var m=new h;m.loadImage(this.basePath+_+".png"),a.addChild(m),m.size(p.getFloat32(),p.getFloat32());var f=p._getMatrix();m.transform=f}}else 1==u&&(i=d[r],i||(d[r]=i=new e,i.interval=this.interval,i._ids=this._ids,i._setData(p,o),i.basePath=this.basePath,i.play(0)));p.pos=this._Pos;break;case 3:this.addChild(d[p.getUint16()]).zOrder=p.getUint16(),c=!0;break;case 4:d[p.getUint16()].removeSelf();break;case 5:d[p.getUint16()][e._ValueList[p.getUint16()]]=p.getFloat32();break;case 6:d[p.getUint16()].visible=p.getUint8()>0;break;case 7:a=d[p.getUint16()];var g=new l(p.getFloat32(),p.getFloat32(),p.getFloat32(),p.getFloat32(),p.getFloat32(),p.getFloat32());a.transform=g;break;case 8:d[p.getUint16()].setPos(p.getFloat32(),p.getFloat32());break;case 9:d[p.getUint16()].setSize(p.getFloat32(),p.getFloat32());break;case 10:d[p.getUint16()].alpha=p.getFloat32();break;case 11:d[p.getUint16()].setScale(p.getFloat32(),p.getFloat32());break;case 98:n=p.getString(),this.event(n),"stop"==n&&this.stop();break;case 99:this._curIndex=p.getUint16(),c&&this.updateOrder(),this._playing&&this.event("enterframe");break;case 100:this._frameCount=this._curIndex+1,this._ended=!0,this.event("end"),this._reset(!1)}this._Pos=p.pos},r._setData=function(t,e){this._data=t,this._start=e+3},r.load=function(t){var e=this;t=u.formatURL(t),this.basePath=t.split(".swf")[0]+"/image/";var i=o.getRes(t);if(i)this._initData(i);else{var a=new o;a.once("complete",null,function(t){e._initData(t)}),a.once("error",null,function(t){}),a.load(t,"arraybuffer")}},r._initData=function(t){this._data=new s(t);var e=0,i=this._data.getUint16();for(e=0;i>e;e++)this._ids[this._data.getInt16()]=this._data.getInt32();for(this.interval=1e3/this._data.getUint16(),this._setData(this._data,this._ids[32767]),this._reset(),this._ended=!1;!this._ended;)this._parse(++this._playIndex);this.play(0),this.event("loaded")},n(0,r,"currentFrame",function(){return this._playIndex}),n(0,r,"totalFrames",function(){return this._frameCount}),n(0,r,"url",null,function(t){this.load(t)}),e._ValueList=["x","y","width","height","scaleX","scaleY","rotation","alpha"],e})(h),function(t){function e(t){this.completeHandler=null,this.dataUrl=null,this.imgUrl=null,e.__super.call(this,t),this.on("complete",this,this._complete)}a(e,"laya.ani.bone.SkeletonPlayer",t);var r=e.prototype;return r._complete=function(){if(this.completeHandler){var t;t=this.completeHandler,this.completeHandler=null,t.run()}},r.load=function(t){this.dataUrl=t,this.imgUrl=t.replace(".sk",".png"),i.loader.load([{url:this.dataUrl,type:"arraybuffer"},{url:this.imgUrl,type:"image"}],_.create(this,this._resLoaded))},r._resLoaded=function(){var t;t=new T(o.getRes(this.dataUrl),o.getRes(this.imgUrl)),this.init(t,t.rate)},n(0,r,"url",null,function(t){this.load(t)}),e}(C)}(window,document,Laya);